

## P 74-75 显示器简介

![[../../annex/LCD-液晶显示_image_1.png]]

![[../../annex/LCD-液晶显示_image_2.png]]

显示器简介
显示器属于计算机的I/O设备，即输入输出设备。它是一种将特定电子信息输出到屏幕上再反射到人眼的显示工具。常见的有CRT显示器、液晶显示器、LED点阵显示器及OLED显示器。

液晶显示器
液晶显示器，简称 LCD (Liquid Crystal Display)，相对于上一代 CRT 显示器 (阴极射线管显示器)，LCD 显示器具有功耗低、体积小、承载的信息量大及不伤眼的优点，因而它成为了现在的主流电子显示设备，其中包括电视、电脑显示器、手机屏幕及各种嵌入式设备的显示器。

###### 液晶显示器
液晶是一种介于固体和液体之间的特殊物质，它是一种有机化合物，常态下呈液态，但是它的分子排列却和固体晶体一样非常规则，因此取名液晶。如果给液晶施加电场，会改变它的分子排列，从而改变光线的传播方向，配合偏振光片，它就具有控制光线透过率的作用，再配合彩色滤光片，改变加给液晶电压大小，就能改变某一颜色透光量的多少。

利用液晶控制的原理，做出可控红、绿、蓝光输出强度的显示结构，把三种显示结构组成一个显示单位，通过控制红绿蓝的强度，可以使该单位混合输出不同的色彩，这样的一个显示单位被称为像素。

注意液晶本身是不发光的，所以需要有一个背光灯提供光源，光线经过一系列处理过程才到输出，所以输出的光线强度是要比光源的强度低很多的，比较浪费能源 (当然，比 CRT 显示器还是节能多了)。而且这些处理过程会导致显示方向比较窄，也就是它的视角较小，从侧面看屏幕会看不清它的显示内容。另外，输出的色彩变换时，液晶分子转动也需要消耗一定的时间，导致屏幕的响应速度低。
![[../../annex/LCD-液晶显示_image_3.png]]


###### LED 显示器
LED 点阵彩色显示器的单个像素点内包含红绿蓝三色 LED 灯，显示原理类似实验板上的 LED 彩灯，通过控制红绿蓝颜色的强度进行混色，实现全彩颜色输出，多个像素点构成一个屏幕。由于每个像素点都是 LED 灯自发光的，所以在户外白天也显示得非常清晰，但由于 LED 灯体积较大，导致屏幕的像素密度低，所以它一般只适合用于广场上的巨型显示器。相对来说，单色的 LED 点阵显示器应用得更广泛，如公交车上的信息展示牌、店招等。
![[../../annex/LCD-液晶显示_image_4.png]]

###### OLED 显示器
新一代的 OLED 显示器与 LED 点阵彩色显示器的原理类似，但由于它采用的像素单元是“有机发光二极管”(Organic Light Emitting Diode)，所以像素密度比普通 LED 点阵显示器高得多

![[../../annex/LCD-液晶显示_image_5.png]]

OLED显示器不需要背光源、对比度高、轻薄、视角广及响应速度快等优点。待到生产工艺更加成熟时，必将取代现在液晶显示器的地位。
对于不同种类的显示器，其控制程序原理是类似的，都是以操作像素点为基础。
![[../../annex/LCD-液晶显示_image_6.png]]


###### 显示器的基本参数
不管是哪一种显示器，都有一定的参数用于描述它们的特性，各个参数介绍如下：

1、像素
像素是组成图像的最基本单元要素，显示器的像素指它成像最小的点，即前面讲解液晶原理中提到的一个显示单元。

2、分辨率
一些嵌入式设备的显示器常常以“行像素值 x 列像素值”表示屏幕的分辨率。如分辨率 800 x 480 表示该显示器的每一行有 800 个像素点，每一列有 480 个像素点，也可理解为有 800 列，480行。

3、色彩深度
色彩深度指显示器的每个像素点能表示多少种颜色，一般用“位”(bit)来表示。如单色屏的每个像素点能表示亮或灭两种状态 (即实际上能显示 2 种颜色)，用 1 个数据位就可以表示像素点的所有状态，所以它的色彩深度为 1 bit，其它常见的显示屏色深为 16 bit（RGB 565，16 个数据位，能够表达 2^16 种颜色）、24 bit（RGB 888，24 个数据位，能够表达 2^24 种颜色）。
RGB 888 -- 红绿蓝分量用 8 个数据位来表示 组成的格式

4、显示器尺寸 
显示器的大小一般以英寸表示，如 5 英寸、21 英寸、24 英寸等，这个长度是指屏幕对角线的长度，通过显示器的对角线长度及长宽比可确定显示器的实际长宽尺寸。

5、点距
点距指两个相邻像素点之间的距离，它会影响画质的细腻度及观看距离，相同尺寸的屏幕，若分辨率越高，则点距越小，画质越细腻。如现在有些手机的屏幕分辨率比电脑显示器的还大，这是手机屏幕点距小的原因；LED 点阵显示屏的点距一般都比较大，所以适合远距离观看。

###### 液晶控制原理
![[../../annex/LCD-液晶显示_image_7.png]]
完整的显示屏由液晶显示面板、电容触摸面板以及 PCB 底板构成。

液晶面板和 PCB 底板实际上是通过 FPC 接口连接的。

图中的触摸面板带有触摸控制芯片，该芯片处理触摸信号并通过引出的信号线与外部器件通讯面板中间是透明的，它贴在液晶面板上面，一起构成屏幕的主体，触摸面板与液晶面板引出的排线连接到PCB底板上。
根据实际需要，PCB底板上可能会带有“液晶控制器芯片”。因为控制液晶面板需要比较多的资源，所以大部分低级微控制器都不能直接控制液晶面板，需要额外配套一个专用液晶控制器来处理显示过程，外部微控制器只要把它希望显示的数据直接交给液晶控制器即可。而不带液晶控制器的PCB底板 ，只有小部分的电源管理电路，液晶面板的信号线与外部微控制器相连，直接控制。STM32F429系列的芯片不需要额外的液晶控制器，也就是说它把专用液晶控制器的功能集成到STM32F429芯片内部了，节约了额外的控制器成本。STM32F1系列的芯片控制液晶时，液晶屏需带有液晶控制器。

###### 液晶面板的控制信号
1、液晶面板的控制信号线 (不带液晶控制器)：
![[../../annex/LCD-液晶显示_image_8.png]]

2、RGB 信号线
RGB 信号线各有 8 根，分别用于表示液晶屏一个像素点的红、绿、蓝颜色分量。使用红绿蓝颜色分量来表示颜色是一种通用的做法，打开 Windows 系统自带的画板调色工具，可看到颜色的红绿蓝分量值，常见的颜色表示会在“RGB”后面附带各个颜色分量值的数据位数，如 RGB 565 表示红绿蓝的数据线数分别为 5、6、5 根，一共为 16 个数据位，可表示 216 种颜色；而这个液晶屏的种颜色分量的数据线都有 8 根，所以它支持 RGB 888 格式，一共 24 位数据线，可表示的颜色为224种。
![[../../annex/LCD-液晶显示_image_9.png]]

3、同步时钟信号 CLK
液晶屏与外部使用同步通讯方式，以 CLK 信号作为同步时钟，在同步时钟的驱动下，每个时钟传输一个像素点数据。

4、水平同步信号 HSYNC
水平同步信号 HSYNC (Horizontal Sync)用于表示液晶屏一行像素数据的传输结束，每传输完成液晶屏的一行像素数据时，HSYNC 会发生电平跳变，如分辨率为 800 x 480 的显示屏 (800 列，480 行)，传输一帧的图像 HSYNC 的电平会跳变 480次。

5、垂直同步信号 VSYNC
垂直同步信号 VSYNC (Vertical Sync)用于表示液晶屏一帧像素数据的传输结束，每传输完成一帧像素数据时，VSYNC 会发生电平跳变。其中“帧”是图像的单位，一幅图像称为一帧，在液晶屏中，一帧指一个完整屏液晶像素点。人们常常用“帧/秒”来表示液晶屏的刷新特性，即液晶屏每秒可以显示多少帧图像，如液晶屏以 60 帧/秒的速率运行时，VSYNC 每秒钟电平会跳变 60次。

刷新率，如：60 hz（60 帧每秒）。每秒从显存中把这些像素数据刷新 60 次，如果显示动态的画面就能显示出来。

6、数据使能信号 DE
数据使能信号 DE (Data Enable)用于表示数据的有效性，当 DE 信号线为高电平时，RGB 信号线表示的数据有效。

###### 液晶数据传输时序
向液晶屏传输一帧图像数据的时序：
![[../../annex/LCD-液晶显示_image_10.png]]

液晶屏显示的图像可看作一个矩形，液晶屏有一个显示指针，它指向将要显示的像素。显示指针的扫描方向方向从左到右、从上到下，一个像素点一个像素点地描绘图形。这些像素点的数据通过RGB数据线传输至液晶屏，它们在同步时钟CLK的驱动下一个一个地传输到液晶屏中，交给显示指针，传输完成一行时，水平同步信号HSYNC电平跳变一次，而传输完一帧时VSYNC电平跳变一次。
![[../../annex/LCD-液晶显示_image_11.png]]

液晶显示指针在行与行之间，帧与帧之间切换时需要延时，而且HSYNC及VSYNC信号本身也有宽度，这些时间参数说明见下表：
![[../../annex/LCD-液晶显示_image_12.png]]
在这些时间参数控制的区域，数据使能信号线“DE”都为低电平，RGB数据线的信号无效，当“DE”为高电平时，表示的数据有效，传输的数据会直接影响液晶屏的显示区域。

###### 显存
液晶屏中的每个像素点都是数据，在实际应用中需要把每个像素点的数据缓存起来，再传输给液晶屏，这种存储显示数据的存储器被称为显存。显存一般至少要能存储液晶屏的一帧显示数据，如分辨率为800x480的液晶屏，使用RGB888格式显示，它的一帧显示数据大小为：3x800x480=1152000字节；若使用RGB565格式显示，一帧显示数据大小为：2x800x480=768000字节。

电脑中这些数据直接存储在电脑中的内存条中，就是说使用内存条划出一块来作为存储显示数据的一个内容，因为是用集成显卡的，是 CPU 集成显卡的。（也有独立显卡）

这个芯片叫液晶控制器，加控制器的主要原因是该 stm 32 系列的驱动性能不足，所以必须要接一个这样的液晶控制器来控制液晶屏幕。自带液晶控制器的屏幕，内部包含了显存（至少有显存空间），然后要把自己的缓存的数据显存里面的数据控制传输到液晶面板上（能够实现时序等，不停的把自己显存空间的内容刷新到屏幕，控制器的功能也在于此）。STM 32 就只需要负责协调和控制跟液晶控制器的通讯（把数据缓存到液晶控制器的显存中，不需要管刷新、HWP 等等）
Stm32f429 芯片不需要额外的液晶控制器，因为 f429 内部在 stm 32 芯片内部集成了。
![[../../annex/LCD-液晶显示_image_13.png]]

电阻触摸屏和电容触摸屏


## P 76--3.2 寸液晶屏介绍

![[../../annex/LCD-液晶显示_image_14.png]]


###### 3.2 寸电阻触摸屏实物
![[../../annex/LCD-液晶显示_image_15.png]]

图中的标号③部分是液晶屏幕的整体，通过引出的排针接入到实验板上可对它进行控制，它分为标号①的液晶触摸面板和标号②的 PCB 底板两部分。

标号①处的液晶触摸面板由液晶屏和触摸屏组成，屏幕表面的灰色线框即为电阻触摸屏的信号线，触摸屏的下方即为液晶面板，在它的内部包含了一个型号为 ILI9341的液晶控制器芯片(由于集成度高，所以图中无法看见)，该液晶控制器使用8080接口与单片机通讯，图中液晶面板引出的 FPC 信号线即8080接口(RGB 接口已在内部直接与 ILI9341相连)，且控制器中包含有显存，单片机把要显示的数据通过引出的8080接口发送到液晶控制器，这些数据会被存储到它内部的显存中，然后液晶控制器不断把显存的内容刷新到液晶面板，显示内容。

标号②处的是PCB底板，它主要包含了一个电阻触摸屏的控制器XPT2046，电阻触摸屏控制器实质上是一个ADC芯片，通过检测电压值来计算触摸坐标。PCB底板与液晶触摸面板通过FPC排线座连接，然后引出到排针，方便与实验板的排母连接。


###### ILI 9341 液晶控制器简介
![[../../annex/LCD-液晶显示_image_16.png]]

该芯片最主核心部分是位于中间的 GRAM(Graphics RAM)，它就是显存。GRAM 中每个存储单元都对应着液晶面板的一个像素点。它右侧的各种模块共同作用把 GRAM 存储单元的数据转化成液晶面板的控制信号，使像素点呈现特定的颜色，而像素点组合起来则成为一幅完整的图像。

框图的左上角为 ILI9341的主要控制信号线和配置引脚，根据其不同状态设置可以使芯片工作在不同的模式，如每个像素点的位数是6、16还是18位；可配置使用 SPI 接口、8080接口还是 RGB 接口与 MCU 进行通讯。MCU 通过 SPI、8080接口或 RGB 接口与 ILI9341进行通讯，从而访问它的控制寄存器(CR)、地址计数器(AC)、及 GRAM。

在GRAM的左侧还有一个LED控制器(LED Controller)。LCD为非发光性的显示装置，它需要借助背光源才能达到显示功能，LED控制器就是用来控制液晶屏中的LED背光源。

GRAM (显存)，把像素数据存储在这里
黄色部分是常用的（8080 接口）。而通常情况下 RGB 用 16 位的颜色深度（RGB 565 的格式）。18 位的话每个像素点 >2 字节、<3 字节，很浪费空间。
IM【3：0】实际上液晶生产厂家直接就固化成知己诶使用 8080 接口了，所以说这个屏幕是没法改成支持 SPI 模式的。跟 STM 32 通讯是比较方便的，直接使用 FSMC 模拟是比较通用的一种方式。
![[../../annex/Pasted image 20240106225117.png]]

###### 液晶屏的信号线及 8080 时序
除了黄色的一些线都是 8080 相关的数据线了（不包括 LCD_BK 背光、LCD_RESET 复位的红色和蓝色都是 8080 的控制线）。红色的就是数据线，蓝色的就是控制线控制信号。
![[../../annex/tmp1704552679038_LCD-液晶显示_image_17.png]]
ILI 9341 控制器根据自身的 IM【3:0】信号线电平决定它与 MCU 的通讯方式，它本身支持 SPI 及 8080 通讯方式，本示例中液晶屏的 ILI 9341 控制器在出厂前就已经按固定配置好 (内部已连接硬件电路)，它被配置为通过 8080 接口通讯，使用 16 根数据线的 RGB 565 格式。内部硬件电路连接完，剩下的其它信号线被引出到 FPC 排线，最后该排线由 PCB 底板引出到排针，排针再与实验板上的 STM 32 芯片连接，引出的排针信号线如下图：

![[../../annex/LCD-液晶显示_image_18.png]]
这些引出的信号线即8080通讯接口，带X的表示低电平有效，STM32通过该接口与ILI9341芯片进行通讯，实现对液晶屏的控制。通讯的内容主要包括命令和显存数据，显存数据即各个像素点的RGB565内容；命令是指对ILI9341的控制指令，MCU可通过8080接口发送命令编码控制ILI9341的工作方式，例如复位指令、设置光标指令、睡眠模式指令等等，具体的指令在《ILI9341.pdf》数据手册均有详细说明。

LCD_DB【15: 0】--D【15: 0】就是作为 RGB 565 格式的像素数据的信号
没有引出 CLK 引脚，所以说我们不是采用同步通讯的，使用异步通讯。
X 代表低电平有效
LCD_RS -- D/CX，这个引脚作为命令和数据的选择端，发送命令的时候就搞成低电平，通过 D【15: 0】D0 到 D15 发送一个信号，信号表示 2Ah。同时 CX 引脚搞成低电平，9341 就知道想发送的这个是命令代码，当成命令来解释。再通过数据线发送几个参数给他，这个时候参数要用数据来表示。

2Ah--0x2A，2A 的 16 进制，命令号就是 2A,它就是一个命令，然后下面发送了命令 Command 之后，可以发送一些命令相关的参数。
![[../../annex/Pasted image 20240106232116.png]]


###### 向 ILI 9341 写命令的时序图：
![[../../annex/LCD-液晶显示_image_19.png]]

写命令时序由片选信号 CSX 拉低开始，对数据/命令选择信号线 D/CX 也置低电平表示写入的是命令地址(可理解为命令编码，如软件复位命令：0x01)，以写信号 WRX 为低，读信号 RDX 为高表示数据传输方向为写入，同时，在数据线 D【17:0】(或 D【15:0】)输出命令地址，在第二个传输阶段传送的是命令的参数，所以 D/CX 要置高电平，表示写入的是命令数据，命令数据是某些指令带有的参数，如复位指令编码为0x01，它后面可以带一个参数，该参数表示多少秒后复位(实际的复位命令不含参数，此处只是为了讲解指令编码与参数的区别)。

当需要把像素数据写入 GRAM 时，过程很类似，把片选信号 CSX 拉低后，再把数据/命令选择信号线 D/CX 置为高电平，这时由 D【17:0】传输的数据则会被 ILI9341保存至它的 GRAM 中。


RESX 复位信号为高电平，表示芯片不处于复位状态，处于正常通讯的状态。
D/CX 数据命令选择信号。
WRX 写使能。
RDX 读使能。
D【17: 0】作为数据/命令的输入。
ILI 9341 -- D【17: 0】(LCD to Host) 这根线就表达从 LCD 到 STM 32 的一个数据。写时序里面，由于数据是从 STM 32 往液晶屏的，所以说写时序的时候数据是不从这里（这根线是没有信号的，这根线不是实际存在的，是一种表示）
主机 -- D【17: 0】(Host to LCD) ，实际上 STM 32 把命令和命令的数据传给 9341 芯片了，表示这么一个方向，这两根线是不存在的。

第一阶段：
首先片选使能，像 SPI Flash 一样，把它拉成低电平，就选中了。选中之后开始通讯。
复位引脚不能把它搞成低电平，不然芯片就在复位了。
命令选择端搞成低电平，发送的是命令。
因为是写命令，所以写使能拉成低电平（有效）。
那么就把数据通过 D【17: 0】配置 D/CX 引脚发送到 ILI 9341 芯片上，当命令来处理。
![[../../annex/Pasted image 20240106233432.png]]
第二阶段：
当数据来处理。
在 D/CX 处不一样。拉成高电平，再把数据参数发送出去。


读时序
![[../../annex/Pasted image 20240106233611.png]]

![[../../annex/Pasted image 20240106233658.png]]

Memory Write 函数
前面还省略了一些内容，比如设置光标，要在屏幕的哪个点显示。
![[../../annex/Pasted image 20240106233740.png]]



## P 77 使用 FSMC 模拟 8080 时序










































































































