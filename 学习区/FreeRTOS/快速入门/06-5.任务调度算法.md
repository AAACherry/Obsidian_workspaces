
![[../../../annex/06-5.任务调度算法_image_1.png]]

Block 又分为 2 类
![[../../../annex/06-5.任务调度算法_image_2.png]]

![[../../../annex/06-5.任务调度算法_image_3.png]]

###### configUSE_PREEMPTION
决定高优先级的任务先执行，配置 configUSE_PREEMPTION 为 1，允许抢占（高优先级的任务可以去抢占低优先级的任务）
![[../../../annex/06-5.任务调度算法_image_4.png]]

![[../../../annex/06-5.任务调度算法_image_5.png]]
任务 3 先执行，第一个变成高电平，打印出 2 个字符后，就进入到了睡眠状态（阻塞状态）5ms。从这个时刻开始，轮到其他任务竞争 CPU 资源。任务 3 进入睡眠状态后，空闲任务、任务 1、任务 2，这三个任务的优先级都是 0，轮流交替执行。

![[../../../annex/06-5.任务调度算法_image_6.png]]
5ms 到了之后，任务 3 继续允许，任务 3 的优先级最高，于是不管什么，立刻得到执行。执行完后又再次调用 delay 函数，于是又轮到任务 2、空闲任务、任务 1 执行。

修改宏 configUSE_PREEMPTION 为 0（取消抢占优先级）
![[../../../annex/06-5.任务调度算法_image_7.png]]
一开始任务 3 执行，任务 3 放弃 CPU 资源后，轮到任务 1 一直执行

在实际应用中，应该去支持抢占，各个函数通过主动放弃来配置。

###### ConfigUSE_Time_Slicing
ConfigUSE_Time_Slicing 时间轮转。同优先级的任务交替执行。这也是一个可以选择的项。可以设置为 0，先到先得不谦让。
![[../../../annex/06-5.任务调度算法_image_8.png]]

如果配置了时间轮转，则各个同优先级的任务交替执行 1 个 tick

![[../../../annex/06-5.任务调度算法_image_9.png]]
没有支持时间片轮转，什么时候放弃 CPU 资源？并不是主动放弃的，是被任务 3 给抢占了。
5 ms 之后，任务 3 又可以重新执行，抢占了 CPU 资源。
任务 3 执行完，主动放弃抢占 CPU 资源（调用 delay 函数）。
放弃之后就会引起一次调度资源，调度器就会说任务 1 霸占执行过了，让任务 2 去执行。
同理执行下去。而空闲任务也是有机会轮转的


###### configIDLE_SHOULD_YIELD
configIDLE_SHOULD_YIELD。空闲任务应该礼让别人。
yield 是协程里的概念。意思是屈服、让步。
通过这个配置，让用户任务先执行。

空闲任务中让别人的实质是：
我们知道，每个任务中都是一个 while 循环，Idle 空闲任务中也是一个 while 循环
![[../../../annex/06-5.任务调度算法_image_10.png]]
礼让别人的意思就在这里。
如果配置的礼让别人这个宏，在 while 循环中只循环一次，循环完之后就触发一次调度，就主动让出 CPU 资源。
如果没有配置的话，在 idle 任务的时间片中，在它的 tick 中会多次循环，原因就在这里。

configIDLE_SHOULD_YIELD 配置为 1，礼让别人
![[../../../annex/06-5.任务调度算法_image_11.png]]
idle 任务的波形图都很小。
波形很小的原因：在 while 循环中，执行了一次之后就马上让出了 CPU 的资源。

![[../../../annex/06-5.任务调度算法_image_12.png]]
未礼让别人，可以看到，空闲任务的 flag 的变量为高电平的时间跟其他的用户任务是差不多的。

![[../../../annex/06-5.任务调度算法_image_13.png]]

![[../../../annex/06-5.任务调度算法_image_14.png]]



弹幕：为啥 Idle 任务没有紧接着任务2执行？？？
弹幕：延迟是没办法做到很精确的，因为调度过程中都会消耗时间
弹幕：把魔术棒调到8Mhz，基本上就是5ms
弹幕：正在执行的任务阻塞后，高优先级的先执行呗
弹幕：1ms 查看一次就绪列表
弹幕：3最先执行可以理解，为啥3阻塞后执行的是1？
弹幕：串口中断怎么办，肯定没有系统的调度中断优先级高，那串口中断不是废了
弹幕：为什么这时候定时器中断不来切换任务1，2呢？
弹幕：这里有点不理解，为什么空闲任务执行次数这么少
















































































































































































