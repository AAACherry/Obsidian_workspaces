

![[../../../annex/03.保存现场的几种场景_image_1.png]]

![[../../../annex/03.保存现场的几种场景_image_2.png]]

![[../../../annex/03.保存现场的几种场景_image_3.png]]

如果是被中断程序打断的话，可以只保存一些
如果是任务切换的话，用到了什么寄存器根本就不知道，所以说如果是任务的切换的话，所有的寄存器都要保留

![[../../../annex/03.保存现场的几种场景_image_4.png]]

有个约定：在 C 函数的调用中，会使用寄存器来传参给子函数，函数 A 本来就知道这几个寄存器会被子函数 B 使用/修改。所以在函数 B 里面，既然是 A 函数传给 B 函数的，没必要进行保存。
![[../../../annex/03.保存现场的几种场景_image_5.png]]
所以在函数调用关系中，子函数要去保存这些现场，有些寄存器是不需要进行保存的。



弹幕：好像不是保存是中断里面的 R0 R1啥的不是正常模式下的 R0 R1 是另外一套独立的寄存器选择哪套寄存器由一个寄存器的值决定，中断里面对中断区的寄存器操作不会影响正常模式下的寄存器
弹幕：一切的复杂性都来自于寄存器数量有限，需要共用，所以保存来保存去
弹幕：这个不需要保存现在的吧，硬件中断结束后应该会恢复那

只要一用到硬件中断（一产生），硬件上就会进行保存这些寄存器（也是保存在栈中）。
在中断程序中，软件上要手动去保存一些寄存器。

在中断程序中，软件上要手动去保存的寄存器并不是全部的。在函数调用关系中，子函数也是只需要保存某些寄存器。
但是在任务切换里面，要把 CPU 让出来给另一个程序去使用。跟另外一个程序没有任何关系，不会帮忙保存寄存器，所以避免自己的寄存器被破坏，在任务切换中，保存现场是保存所有的寄存器。
![[../../../annex/03.保存现场的几种场景_image_6.png]]
































































































































































