1.Debug 修改值没有变化（点击运行值还是没改变），注意有没有在对应位置打断点

2.储工说5.4和6.0版本的 keil 对于循环的处理会不一样；然后储工那边应该是5.4版本的 keil；所以他烧完算法后，语音 IC 的时序就乱了

3.​​如果通过 break 退出 VoiceOver 后的循环，程序会顺序执行 ChangeMemoryIndex 标签后的代码；如果通过 goto 退出，则不会执行



```
语音调试，挨个播报语音
int A;	
	#if 1
	while(1)
	{
		for(A = 0xE6; A<0xff; A++)  //A = 0x80;
		{
			ShowAllIcon();
			delay(10);
			DarkAllIcon();
			delay(10);
			SoundCommand(A);
			delay(10);
			SoundCommand(0xFe);delay(10);
		SoundCommand(0xbe);
			
		}
	}
	#endif

```



```
do
	{	
	    MemoryMode=1;   
				ResultDataS = 200-Det_DIA;        		
				ResultDataD = 140-Det_DIA;	
				ResultDataH = 40+Det_DIA;

		if(Det_DIA==(IDbuffer.b-5))
		{
			ResultDataS=110;
			ResultDataD=70;
			ResultDataH=60;
		}
		else if(Det_DIA==(IDbuffer.b-4))
		{
			ResultDataS=105;//125
			ResultDataD=78;//70
			ResultDataH=60;//60
		}
		else if(Det_DIA==(IDbuffer.b-3))
		{
			ResultDataS=121;//135
			ResultDataD=71;//80
			ResultDataH=60;//60
		}
		else if(Det_DIA==(IDbuffer.b-2))
		{
			ResultDataS=118;//140
			ResultDataD=68;//90
			ResultDataH=60;//60
		}
		else if(Det_DIA==(IDbuffer.b-1))
		{
			ResultDataS=132;//160
			ResultDataD=75;//100
			ResultDataH=60;//60
		}
		else if(Det_DIA==(IDbuffer.b))
		{
			ResultDataS=132;//180
			ResultDataD=68;//110
			ResultDataH=60;//60
		}		
		
		Day+=5;
		if (Day>25)
			{
	        	 Day=1;
	        	 Month++;
	        	 if (Month==13)
	        	 {
	        	 	 Month=1;
	        	 	 Year.b++;
	        	 }
	        }
	        	        
		Hour=Det_DIA%24;	        
		Minute=Det_DIA%60;
		ResultDataDA = Day+(Month&0x03)*64;		//M0+data
		ResultDataHO = Hour+(Month&0x0c)*16;  
		ResultDataMI = Minute;	       

//		lastmodeAV ^= 1;				//set average mode	
		savetomemory(); 
		DisplayToSYSDIA(Det_DIA,2);	
		DisplayToPUL(MemoryEndIndex);
		Det_DIA++;	                 	             
        
	}while(Det_DIA<=IDbuffer.b);

```


```
U80QH，循环断点测试
uint8 xdata test1;
uint8 xdata test2;	
	do
	{
		ShowWHO(test1,test2);
	}while(KEY_POWER);
```


```
位操作详细说明
1. ResultDataDA = Day + (Month & 0x03) * 64;
// Month & 0x03: 取月份的低2位（二进制最后两位）
// 乘以64: 相当于左移6位（2^6=64）
// 加上Day: 将日期放在低6位
​​二进制表示​​：

[月份低2位(2位)] [日期(6位)]
2. ResultDataHO = Hour + (Month & 0x0c) * 16;
// Month & 0x0c: 取月份的3-4位（二进制位2-3）
// 乘以16: 相当于左移4位（2^4=16）
// 加上Hour: 将小时放在低4位
​​二进制表示​​：

[月份高2位(2位)] [小时(4位)]
3. ResultDataMI = Minute;
// 分钟直接存储，不需要压缩



实际示例说明
假设当前时间为：​​3月15日10点30分​​

1. 月份处理
月份 = 3 (二进制: 00000011)
Month & 0x03 = 00000011 & 00000011 = 00000011 (十进制3)
Month & 0x0c = 00000011 & 00001100 = 00000000 (十进制0)
2. 计算ResultDataDA
ResultDataDA = 15 + (3 * 64) = 15 + 192 = 207
​​二进制分析​​：

192 = 11000000 (月份低2位: 11)
15  = 001111 (日期: 15)
合并: 11001111 = 207
3. 计算ResultDataHO
ResultDataHO = 10 + (0 * 16) = 10 + 0 = 10
​​二进制分析​​：

0 = 0000 (月份高2位: 00)
10 = 1010 (小时: 10)
合并: 00001010 = 10
4. 最终存储
ResultDataDA = 207  // 包含月份低2位和日期
ResultDataHO = 10   // 包含月份高2位和小时  
ResultDataMI = 30    // 分钟直接存储


```


```
uint8   xdata			MemoryArray28[7][4][8];   //7天,4组，每组8个byte
```

![[../../annex/06.入职第七周8.25-8.29（双休）_image_1.png]]

![[../../annex/06.入职第七周8.25-8.29（双休）_image_2.png]]
优瑞恩 U80QH，7天平均值，如果需要 WHO，在此处加上 WHO 显示。


```
优瑞恩U81K，自定义进线性方式
if(!KEY_MEMORYDOWN)
		{
			while(!KEY_MEMORYDOWN)
			{
				if(!KEY_MEMORYUP)
				{
					IsCalibrate=1;	
				  IsPowerOn = 1;
				}
			}
		}
		
```


```
优瑞恩U81K，用户键进入切换用户
if(!KEY_MEMORYDOWN)
				{
					InitialLoop();
					UserABDisplay();
					while(!KEY_MEMORYDOWN);
					keydelay();
					do								//设定UserA及userB
					{ 
						UserABDisplay();
						AutoOffTimew = 0;
						do{
							if(AutoOffTime2b > AUTOOFFTIME){goto UserSetOver3;}
							}while(KEY_MEMORYDOWN&& KEY_POWER);
							
						if(!KEY_MEMORYDOWN)
							{
								if(UserA==1)
									{
										UserA=0;
									}
								else{UserA=1;}
								UserABDisplay();  				
								while(!KEY_MEMORYDOWN);
								keydelay();					
							}
					}while(KEY_POWER);
					UserSetOver3:
					SaveSet();			
					IsPowerOn=0;
					goto STARTUP;					
				}
```


![[../../annex/06.入职第七周8.25-8.29（双休）_image_3.png]]

![[../../annex/06.入职第七周8.25-8.29（双休）_image_4.png]]


```
void LifeTest(void)
{
    unsigned int LifeTime = 0;
    IsCalibrate = 0;
    PUMPPWMValue = 65535;
    DarkAllIcon();
    while (!KEY_POWER||!KEY_MEMORYUP);
    delay(8);
	//读取记忆次数
	
    EEPROMin = LifeTestAdd;
    readM24L16();
    if (inbyte[6] == 0xac)
    {
        LifeTime = inbyte[0];
        LifeTime <<= 8;
        LifeTime += inbyte[1];
    }
    else
    {
        LifeTime = 0;
    }

    LCD5bitDisplayT(LifeTime);
    while (KEY_POWER && KEY_MEMORYUP && KEY_MEMORYDOWN);
    if (!KEY_POWER) LifeTime = 0;
	delay(150);	
    do
    {
        LifeTime++;
        LCD5bitDisplayT(LifeTime);
        if (LifeTime % 10 == 0)
        {
            EEPROMin = LifeTestAdd;
            outbyte[0] = LifeTime / 0x100;
            outbyte[1] = LifeTime % 0x100;
            outbyte[6] = 0xac;
            writeM24L16();
        }
        zerotracing();
        BB = PUMP | VALVE;
        iocontrolon();
        AutoOffTimew = 0;
        do
        {
            delay(1);
            CheckBatteryCOM();
            calpressure();
            showpressure();
            if (AutoOffTimew > LifeTestONE * 15)
            {
                ResultCode = 3; // set result code = 3
                showerror();
				goto LifeOver;
            }
            if (!KEY_TIME)
            {
                BB = PUMPOFF | VALVEOFF;
                iocontroloff();
                while (!KEY_TIME);
                keydelay();
                while (KEY_TIME);
                while (!KEY_TIME);
                keydelay();
                AutoOffTimew = 0;
                BB = PUMP | VALVE;
                iocontrolon();
            }
        } while ((PressuremmHgw < 300) && (KEY_POWER) && IsPowerOn);

        BB = PUMPOFF | VALVEOFF;
        iocontroloff();
        AutoOffTimew = 0;
        do
        {
            delay(1);
            CheckBatteryCOM();
            calpressure();
            showpressure();
            if (AutoOffTimew > LifeTestONE * 8)
            {
                ResultCode = 3; // set result code = 3
                showerror();
				goto LifeOver;
            }
        } while ((PressuremmHgw > 0) && (KEY_POWER));
    } while (KEY_POWER && IsPowerOn && (LifeTime <= 60000));//??????,???10000???,??65535?
    while (KEY_POWER);
	LifeOver:
	 IsPowerOn = 0;
}
```


```
while(1)
	{
		ShowWHO(test1,test2);
		SystolicValue1b=85;
		DiastolicValue=55;
		i=80;
		SoundResult();
	}
```


```
else if((VoiceType==ARB) && (mmHgkPaFlag))
	{
		SoundCommand(0xFe);
//		if(!KEY_POWER) {VoiceStop=1;SoundCommand(0xFe);goto EXIT;}
		if(mmHgkPaFlag) SoundPressure(SystolicValue1b,DiastolicValue,i);
//		if(!KEY_POWER) {VoiceStop=1;SoundCommand(0xFe);goto EXIT;}
		if(VoiceStop) goto EXIT;
		if(WithWHO) SoundAllCommand(0x66,WHOLevel,0,0);
//		if(!KEY_POWER) {VoiceStop=1;SoundCommand(0xFe);goto EXIT;}
		if(VoiceStop) goto EXIT;
		//if(WHOLevel==6) SoundCommand(0xBD);// VOICE IC HAS FIXED
	}
```

电源→语音→阀门、气泵→Type-C

https://mp.weixin.qq.com/s/cSEgyOOIaoNfABD10CvQbA




























































