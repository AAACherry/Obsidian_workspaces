
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_1.jpg]]
↑松瀚烧录器[2025-11-16 00：25：10]


### 电子负载仪
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_2.jpg]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_3.jpg]]











































### 蓝牙模块
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_4.jpg]]

蓝牙模块正常是3.3V，之前测出2.7V 是因为三极管用错型号（实际8050 的三极管 BOM 表写成了 8550），多了一个三极管的压降到了2.7V，不过也能工作，但是有风险(低电可能不工作)




### 压力传感器
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_5.jpg]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_6.jpg]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_7.jpg]]




### PCM 出现的问题

#### 测量模式下，电压从 4 V 调到 3 V 出现屏闪问题
@黄芝广-软件  @陈裕林-软件 pcm02在生产电流站位发位3.3V 电压开机先闪屏再显低电符号，麻烦看一下是什么原因。
硬件问题，没有正常启动。电平不匹配，至少需要>2.8V。而产品多了一个二极管的压降，导致电平不匹配。出现闪屏现象。

@储双双储工，上班之后麻烦发一下 PCM02的目前最新的软件，产线之前组装的机器需要重新烧软件
另外昨天发现 PCBA 有3.45V 不报低电的情况，所以 PCM01、02的 PCBA 需要在原本的 R5（137KΩ）上再叠加1个1.6MΩ的电阻，可行性昨天晚上已经验证可以
@刘红运刘总，昨天晚上的这个方案，现在工厂这边没有找到1.6M 的电阻，能否用1.5M 的电阻替换？麻烦评估一下

@农凤肖农姐，麻烦帮忙确定一下这几个参数的范围
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_8.jpg]]
这款产品这数据也要测试吗
参照血压计的法规标准来，里面有写规定是多少范围的
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_9.png]]

@刘红运  @农凤肖   DD040生产中发现3.8V 闪屏（软件版本11.11）， 4.1V 会报低电关机各1台

@刘红运  @农凤肖    DD040 新问题：测电流电压站位发现，插电源插座和开机，阀会响，现在已经停线，两位工程师正在分析。

@朱敏蓝牙模块驱动三极管管引脚是对的，可以直接更换8550

11.13 线性不准--未进行标定
11.13 标压值不稳定气路批锋
11.13 3.8 V 闪屏--蓝牙模块坏了，把电压拉低
11.13 4.1 V 低电--MCU 连锡
11.13  插电源端子阀异响响--MCU 连锡
11.13 开机的乱闪 --未分析出原因
11.13 发现一台 3.47 不关机
11.13 3.8 V 关机，阀异响
11.13 3.5 V 不关机阀异响
11.13 关机电流大
11.13 按任意键阀响

@储双双 @农凤肖 @刘红运由于生产需要减少不必要的操作，在垫子尺寸设置界面（按住开关键+短按3下设置键进入），需要将短按开关键保存设置并开始充气，改为保存设置并关机，这次的 PCM01和02软件需要都修改

黄芝广，11 月 13 日晚上 23 点 56 分：
1、3.8 V 屏幕乱闪，原因：蓝牙模块坏了，拉低了 VM
2、任意按键和接电源漏气阀会开，原因：阀的驱动脚连锡导致的
3、3.47 V 不报低电，原因：R 5 分压电阻焊接了两个 1.6 M 的电阻；3.5 V 不报低电的是没并联 1.6M 电阻
4、一台上电会反复全显。未找到原因，芯片可以烧录程序；带回去分析
5、3.8 V 按开机键开机全显后显示 0 格电量和偶尔低电关机，目前分析原因：由于比较器输入的电压过了个二极管，全显时电压拉低到 3.5 V，此时分压电阻的电压在 1.2 V 附近；软件的避免方法是：去掉全显时检测电量和比较器或者在全显完后再检测电量和比较器
6、关机电流 760 uA 的机器，目前把外围电路都断开后，主控功耗还是 760 uA，带回去明天换主控 IC 对比是否功耗还是一样


###### 8550 三极管 BOM 写成了 8050
陈志宏，11 月 14 日 0 点 17 分：
3.6V 供电，VM3.0V 蓝牙连接 APP 上传数据时示波器测量蓝牙供电是2.56V
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_10.jpg]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_11.jpg]]
通讯脚波形是方波没形变


这里面还有两台不良还没有给分析结果@刘红运 @农凤肖 
带回去两台，闪屏的一台是晶振问题，更换后没问题了，另外一台电流大的已经叫潘工帮忙分析中@kama 
晶振问题测量是参数不对吗。通知供应商过来现场确认分析
没有起振，重新焊回去后也是不行，会闪屏，这台保留，我叫厂家过来分析

出现 100μA 和 700μA 电流大的问题（正常电流为 60-70μA）。拆掉外围电路偶仍然出现电流大的问题，单独直接给 VM 供电，会进入充电模式。
潘工：
@chen  @马利平  @朱敏电流大（700 μA）的原因找到了，为 SW 烧录线与 USB 5.1K 电阻短路
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_12.png]]
这2短路 PIN


@农凤肖 @农凤肖  PCM 02 测试完红外垫以后，长按关机，静置 2-3 分钟有一下现象：
1.机器会自动充气（屏幕不亮）  然后报 E-3
2.还有睡眠图标亮起时不时又亮起，
软件版本：1114 @储双双 

@储双双这个就跟我昨晚跟放在你桌面的那台现象一样

@储双双 @农凤肖因生产时需要查看校准次数，需要修改软件，增加查看校准次数的界面，若目前软件已经不需要修改，则下批生产时增加，若目前软件仍需修改，则麻烦增加该界面

原因：进入工程模式后退出实际未进入关机状态；而是处于休眠状态（休眠状态隔一会会亮一下屏、泵工作打几下气）


@chen @刘红运 @储双双 @农凤肖产线的产品没有开机，在手机 App 上面有8-9个待连接蓝牙的状态
我刚回去。看下三极管是不是有没换的，有换的是有松香痕迹的，分批次单独拿到办公室那里去看下
先拿几个到外面看看，如果有已经是换过三极管的，再用万用表量下 Q7三极管旁边的电阻电压，看下关机状态下是3V 还是 0V
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_13.jpg]]
@chen 2.46V

你量的是电阻两端的电压是吧

是的


### RAK-301 空间不够
罗林桥 11 月 15 日 16 点 30 分：
@刘红运   @王帅亮-软件工程师  @储双双-研发   @朱敏  RAK-301使用松翰 sn8p2977a mcu，写普通的测温，写不下。杨工说编译器没有优化空间的处理。
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_14.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_15.png]]


### 
潘工：
@朱敏蜂鸣器二极管不能去，去掉后方向电压太高了，超出三极管 CE 极25V 的耐压
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_16.jpg]]
这个是有二极管

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_17.jpg]]
这个是无二极管

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_18.png]]


### FY_B01 血压计零点校压卡主的问题
①现象：FY_B 01：程序卡在零点校准（zerotracing 函数）那里一直闪烁"0"。
②通过平头哥 CKLink，蓝色 CDK；进行仿真 debug。采集到的数据发现：③SensorCountw 和 ZeroCountw 的差值一直 Mathlw>8，会把循环变量 N 重置为 0，所以一直卡在零点校准、闪烁"0"（上次的 SensorCountw 值（即 ZeroCountw）与新采集到的 SensorCountw 值进行比较时会＞8）。SensorCountw 的值一直飘。
④根本原因：压力传感器坏了（压力传感器那部分的电路出现问题）。拆换压力传感器即可（左右开弓，拆焊 FY_B01压力传感器，用2个烙铁左右开工（2个烙铁夹击压力传感器，锡融化了就撩出来））。
⑤方少那边是差值非常大，达到万级别，尚不清楚原因，应该也是压力传感器坏了。结果：方翔云卡在零点校准的问题，通过使用自动工装机/手动校压，校压后恢复正常。
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_19.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_20.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_21.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_22.png]]
拆焊 FY_B01压力传感器，用2个烙铁左右开工（2个烙铁夹击压力传感器，锡融化了就撩出来）
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_23.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_24.png]]


FY_B01的 LED 电路图。采用了2个 TM1640去驱动 LED（灯比较多）
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_25.png]]


### 阀响为开，高电平
阀响为开。一般情况下，公司的设计是阀门的 IO 控制脚高电平时，阀门关闭；低电平时，阀门关闭。


### LifeTest 万次寿命加压不上去
马林的干电样机、干电的泵，泵打不上气300mmHg，没进行校准（实际已经打气到了300mmHg，但是没有标准，泵只显示200多）。

锂电840E 泵打不上气的原因（40s 内最多到250mmHg 就报错）是泵不匹配，（6V）干电的泵、4V 锂电的机器。
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_26.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_27.png]]



### 存储空间使用情况
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_28.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_29.png]]


### 比较器、ADC 和泵不能同时使用


### 2 个串口共地、2 个 RX 接线对比
2个串口共地，RX 分别接 TX、RX；看收发的速度对比，是哪里出现了问题（是单片机处理速度（有延时？有阻塞？）还是蓝牙传输）
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_30.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_31.png]]

```
HEX指令
FD FD 19 01 02 64 00 1A 3C 96 1E 02 02 01 FE 07 E9 08 09 13 32 DA 0D 0A
FD FD 09 01 03 07 E9 08 09 0B 14 24 0D 0A
FD FD 04 01 02 00 03 0D 0A
```

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_32.png]]
99组记忆，全部发送和存储完需要4min 多
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_33.png]]




### Flash 全擦，EEPROM 字节擦
Flash 全擦，EEprom 可 bit 擦 (高低电平)。
Delay，13.3 ms，delay (75)约为 1 s

### PCM 01
user_manual_off_flag == 0：非用户手动关机
PCM01和 PCM02: ENGMODE 变量标志位（意指工程模式）

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_34.png]]

##### 删/写记忆测试函数
```
void writefullmemory(void)
{
	uint8 N;
DarkAllIcon();
	for(N=0;N<MemorySet;N++)
	{
		setengdata(N);
		saveresultdata(0,0);
		DisplayToMemorySet(N+1);
		
showdate(result_data.Month,result_data.Day); //日期
		
		delay(5);
	}
delay(75);//test
	WorkMode = 0;
	arrange_day_count();
}
```

```
void CLRMemoryBank(void)
{
	//InitialLoop();
	
	DarkAllIcon();
	
	MemoryIndex = 0;
	MemoryEndIndex = 0;
	
	Byte_WtNO(ROM_MEMORY_Index,MemoryIndex);
	Byte_WtNO(ROM_MEMORY_Index + 1,MemoryEndIndex);
	
	delay(5);
	
	AutoOffTimew = 0;
	do
	{
		if (T250ms == 0)
		{
			if (OneShot == 1)		// if one shot flag = 0 then
				{
					DisplayToMemorySet(0X00);
					DisplayHalfByte(0X0C,SleepHourTen);	//"C"
					DisplayHalfByte(0X13,SleepHourSingle);	//"L"
					// if 1/4 second to show Clear Memory
					OneShot = 0;
				}
		}
		else
		{
			if (OneShot == 0)		// if one shot flag = 0 then
				{
					OneShot = 1;		// set on shot flag = 1
					DisplayHalfByte(disp_empty,MemorySetTen);
					DisplayHalfByte(disp_empty,MemorySetSingle);
					DisplayHalfByte(disp_empty,SleepHourTen);
					DisplayHalfByte(disp_empty,SleepHourSingle);
				}
		}
	}while(AutoOffTimew <= offtime_2s);
	
	DarkAllIcon();
	WorkMode = 0;
	return;
}

uint8 testaaaaa = 1;
uint8 Countw2 = 0;
void setengdata2(uint32 Countw)
{
	//Countw/=2;
if(testaaaaa==1)
{
	Countw2 =99;
	testaaaaa = 0;
	result_data.RR = 5 + Countw2 %50;
	result_data.PR = 100 + Countw2 %10;
	result_data.max_RR = result_data.RR + 5;
	result_data.max_PR = result_data.PR + 5;
	result_data.TO = 100+Countw2%20;
	result_data.LTime = 100+Countw2%30;
	result_data.DTime = 50+Countw2%20;
	result_data.totaltime = 200;
	result_data.Year=25;
	result_data.Month = 11;	//1+Countw%10;
	result_data.Day = 10;	//1+Countw%28;
	result_data.Hour = Countw2%24;
	result_data.Minute = Countw2%10;
	
	result_data.endtime[0] = result_data.Year;
	result_data.endtime[1] = result_data.Month;
	result_data.endtime[2] = result_data.Day;
	result_data.endtime[3] = result_data.Hour;
	result_data.endtime[4] = result_data.Minute + 30;
	
	result_data.sleep_mark = 1+Countw2%3;
	result_data.motion_mark = result_data.RR;
	result_data.AlreadySendflag = 0;
	
	result_data.checksum = calcs(result_data);
	
	delay(20);
	return;
}		
	
	result_data.RR = 5 + Countw %50;
	result_data.PR = 100 + Countw %10;
	result_data.max_RR = result_data.RR + 5;
	result_data.max_PR = result_data.PR + 5;
	result_data.TO = 100+Countw%20;
	result_data.LTime = 100+Countw%30;
	result_data.DTime = 50+Countw%20;
	result_data.totaltime = 200;
	result_data.Year=25;
	result_data.Month = 11;	//1+Countw%10;
	result_data.Day = 10;	//1+Countw%28;
	result_data.Hour = Countw%24;
	result_data.Minute = Countw%10;
	
	result_data.endtime[0] = result_data.Year;
	result_data.endtime[1] = result_data.Month;
	result_data.endtime[2] = result_data.Day;
	result_data.endtime[3] = result_data.Hour;
	result_data.endtime[4] = result_data.Minute + 30;
	
	result_data.sleep_mark = 1+Countw%3;
	result_data.motion_mark = result_data.RR;
	result_data.AlreadySendflag = 0;
	
	result_data.checksum = calcs(result_data);
}

void writefullmemory2(void)	//5组记忆,used for test
{
	uint8 N = 0;
	uint8 M = 0;
//	checkmemorybank();
//	N = MemoryEndIndex;
	DarkAllIcon();
	MemoryIconOn;
	do
	{
		if(!KEY_MEMORYUP) {delay(2);while(!KEY_MEMORYUP);N++;}
		
		if(N!=M)
		{
			M++;
			setengdata2(N);
			saveresultdata(0,0);
			DisplayToMemorySet(M);
			delay(5);
		}
//		checkmemorybank();
//		if(N>MemoryEndIndex)
//		{
//			setengdata(N-MemoryEndIndex);
//			saveresultdata(0,0);
//			DisplayToMemorySet(N-MemoryEndIndex+1);
//			delay(5);
//		}
	}while(KEY_POWER);
	WorkMode = 0;
	arrange_day_count();
}
```


```
void writefullmemory2(void)
{
	uint8 N;
	for(N=0;N<10;N++)
	{
		setengdata(N);
		saveresultdata(0,0);
		DisplayToMemorySet(N+1);
		delay(5);
	}
	WorkMode = 0;
	arrange_day_count();
}
```


![[../../annex/18.入职第十八周11.9-11.15(单休)_image_35.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_36.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_37.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_38.png]]


##### 电量显示测试函数

```
DisplayHalfByte(BatValue/100,SleepHourTen);		//test
	DisplayHalfByte(BatValue/10%10,SleepHourSingle);
	DisplayHalfByte(BatValue%10,SleepMINSingleTen);
	delay(150);
```

```
//******************************************************************************
//checkbattery
//******************************************************************************
void ReadBatADC(void)
{
	uint16 BatValue_min = 6000;
	uint16 BatValue_max = 0;
	uint32 BatValue_sum = 0;
	uint8 ad_i=0;
	
	for(ad_i = 0;ad_i < 10;ad_i++)
	{
		addelay();
		
		TemplateValueLong=SensorCountw;	
		TemplateValueLong*=792;
		TemplateValueLong/=32768;
		BatValue=TemplateValueLong;
		if(WorkMode == 1 && (!FULL || !CHRG)) BatValue+=5; 	//工作状态下充电补偿小一点
		else BatValue+=15;
		
		if(BatValue_min > BatValue)
		{
			BatValue_min = BatValue;
		}
		if(BatValue_max < BatValue)
		{
			BatValue_max = BatValue;
		}
		
		BatValue_sum += BatValue;
		
	}
	
	BatValue = (BatValue_sum - (BatValue_min + BatValue_max))/8;
	
	
	if (WorkMode==7&&IROutput_value==3&&IR_WorkFlag==1)
	{
		BatValue+=20;
	}
	
	
	DisplayHalfByte(BatValue/100,SleepHourTen);		//test
	DisplayHalfByte(BatValue/10%10,SleepHourSingle);
	DisplayHalfByte(BatValue%10,SleepMINSingleTen);
	delay(150);
	
	if(charge_flag == 0)
	{
		charge_flag = 1;
		Max_batVal = BatValue;
	}
	else
	{
		if (BatValue>Max_batVal)
		{
			BatValue = Max_batVal;
		}
		else
		{
			Max_batVal = BatValue;
		}
		
	}
	if(BatValue>400) BTLevel=3; //4.0V
	else if(BatValue>385) BTLevel=2;
	else if(BatValue>370) BTLevel=1;
	else BTLevel=0;
	
	DisplayHalfByte(BatValue/100,SleepHourTen);		//test
	DisplayHalfByte(BatValue/10%10,SleepHourSingle);
	DisplayHalfByte(BatValue%10,SleepMINSingleTen);
	delay(150);
	//while(KEY_MEMORYDOWN); //test
}
```


```
void ChargeMode(void)
{
	uint16 over_voltage_time = 0;
	uint8 over_voltage_full = 0;
	uint16 full_high_cnt,full_low_cnt,charge_high_cnt,charge_low_cnt;
	uint8 chargefull,charging;//充满标志位
	chargefull = 0;
	charging = 0;
	full_high_cnt = 0;
	full_low_cnt = 0;
	charge_high_cnt = 0;
	charge_low_cnt = 0;
	InitialLoop();
	charge_mode;
	WorkMode=0;
	ShowBTLevel=0;
	ADC_Meas_Battery_Init();
	delay(8);
	LedTime=0;
	IsMinute = 0;
	while(1)
	{
		ADOKFlag=0;
		while(!ADOKFlag)
		{
			if(!FULL)
			{
				full_low_cnt++;
				if (full_low_cnt>30000)
				{
					full_low_cnt=30000;
				}
				
			}
			if(FULL)
			{
				full_high_cnt++;
				if (full_high_cnt>30000)
				{
					full_high_cnt=30000;
				}
				
			}		
			if (!CHRG)
			{
				charge_low_cnt++;
				if (charge_low_cnt>30000)
				{
					charge_low_cnt=30000;
				}
				
			}
			if (CHRG)
			{
				charge_high_cnt++;
				if (charge_high_cnt>30000)
				{
					charge_high_cnt=30000;
				}
				
			}
		}
		if (full_high_cnt>300&&full_low_cnt>300)
		{
			chargefull=1;
		}
		else
		{
			chargefull = 0;
		}
		if (charge_high_cnt>300&&charge_low_cnt>300)
		{
			charging = 1;
		}
		else
		{
			charging = 0;
		}

		full_high_cnt=0;
		full_low_cnt=0;
		charge_high_cnt=0;
		charge_low_cnt=0;
		if (T250ms == 0)
		{
			if (OneShot == 1)
			{
				TemplateValueLong=SensorCountw;	
				TemplateValueLong*=792;
				TemplateValueLong/=32768;
				BatValue=TemplateValueLong;
				//BatValue+=15;
				
				if(BatValue>400) BTLevel=3; //4.0V
				else if(BatValue>385) BTLevel=2;
				else if(BatValue>370) BTLevel=1;
				else BTLevel=0;
				if(BTLevel>0) BTLevel--;

				DisplayHalfByte(BatValue/100,SleepHourTen);		//test
				DisplayHalfByte(BatValue/10%10,SleepHourSingle);
				DisplayHalfByte(BatValue%10,SleepMINSingleTen);
				
				ShowBTLevel++;
				if(ShowBTLevel<BTLevel) ShowBTLevel=BTLevel;
				if(ShowBTLevel>3) ShowBTLevel=BTLevel;
				if (chargefull == 1 || over_voltage_full == 1 ||charge_mark_sec > 0)
				{
					ShowBTLevel = 3;
					
					charge_mark_sec = 180;//3min
				}
				
  				ShowBat(ShowBTLevel);
				
				OneShot=0;
			}
		}
		else
		{
			if (OneShot == 0)			// if one shot flag = 0 then 
			{
					OneShot = 1;		// set on shot flag = 1 
			}
		}
		
		if(BatValue < 415) 
		{
			over_voltage_time = 0;
			over_voltage_full = 0;
		}
		else
		{
			over_voltage_time ++;
			if(over_voltage_time >= offtime_30min)
			{
				over_voltage_time = offtime_30min;
				over_voltage_full = 1;
			}
		}
		
		CheckKeyMode();
		
		if (IsHour<24 && IsMinute>=3 && user_manual_off_flag == 0 && checkzero())	//IsHour>=24,休眠24h后关机
		{
			Auto_Wakeup=1;
			WorkMode = 1;
			break;
		}
		
		if(WorkMode>0){break;}
		if(CHRG&&FULL&&(!charging)&&(!chargefull))
		{
			keydelay();
			if(CHRG&&FULL) break;
		}
	}
}
```


```
void show_bat(void)
{
	static uint16 charge_cnt = 0;
	uint8 btlevel_bak;

	if (!FULL||!CHRG)
	{
		if(charge_cnt < 25) charge_cnt ++;
		
		charge_mode;
		charge_flag = 0;
		if (T250ms == 0)
			{
				if (OneShot == 1)
				{
					//ReadBatADC();
					if(charge_mark_sec > 0) t_chargefull = 1;
					
					if(BatValue>400) BTLevel=3; //4.0V
					else if(BatValue>385) BTLevel=2;
					else if(BatValue>370) BTLevel=1;
					else BTLevel=0;
					
					btlevel_bak = BTLevel;
					
					if(BTLevel>0) BTLevel--;

					ShowBTLevel++;
					if(ShowBTLevel<BTLevel) ShowBTLevel=BTLevel;
					if(ShowBTLevel>3) ShowBTLevel=BTLevel;
					
					if (t_chargefull == 1 || charge_mark_sec > 0)
					{
						ShowBTLevel=3;
						
						charge_mark_sec = 180;
					}
					
					
					BTLevel = btlevel_bak;
					OneShot=0;
				}
			}
			else
			{
				if (OneShot == 0)			// if one shot flag = 0 then 
				{
						OneShot = 1;		// set on shot flag = 1 
				}
			}
						DisplayHalfByte(BatValue/100,SleepHourTen);		//test
						DisplayHalfByte(BatValue/10%10,SleepHourSingle);
						DisplayHalfByte(BatValue%10,SleepMINSingleTen);
			
			ShowBat(ShowBTLevel);
						DisplayHalfByte(BatValue/100,SleepHourTen);		//test
						DisplayHalfByte(BatValue/10%10,SleepHourSingle);
						DisplayHalfByte(BatValue%10,SleepMINSingleTen);

	}
	else
	{
		if(charge_cnt > 0) charge_cnt --;
		if(charge_cnt == 0)
		{
			if (t_chargefull == 1)
			{
				ShowBTLevel=3;
			}
			if (leddisp_off == 0)
			{
				ShowBat(BTLevel);
			}
		}
	}
	
	
}
```


```
if(toAdcCheckFlag == 1)
		{
			toAdcCheckFlag = 2;
			CheckBatteryADC();
			
			DisplayHalfByte(BatValue/100,SleepHourTen);
			DisplayHalfByte(BatValue/10%10,SleepHourSingle);
			DisplayHalfByte(BatValue%10,SleepMINSingleTen);
			
//			while(KEY_MEMORYDOWN); //test
			
			if(BatValue<358)
			{
				ShowLBTandReturn();
			}
			
			//while(KEY_MEMORYDOWN); //test
			delay(15);
			set_adc_zoom();  //切换回传感器AD
		}
```

3.93 V； 419-423；4.15；406-411
3.75 V;   395-398；3.93 V;  388-389-391->371->368





##### 烧录程序失败问题
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_39.png]]
Download 加载到一半烧录不进入程序。
烧录不进去代码，每次 Flash download 加载到50%就报错了。

##### 电量检测和低电判断处理
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_40.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_41.png]]

全显之前检测一次低电；正常测量时，打气时切换 ADC 检测一次低电，随后切换回打气（不使用时用比较器检测低电，充气时只用 ADC 检测一次低电）。

##### G_state 状态切换
G_state 进行状态切换：
STATE_STANDBY: 待机状态
   显示一些图标和横杠，如果超过 3 分钟没有活动则进入睡眠状态（STATE_SLEEP）。

STATE_SLEEP: 睡眠状态
   显示跑马灯效果，如果检测到活动或按键，则切换到显示 10 秒状态（STATE_Disp 10 S）或运动状态（STATE_MOVEMENT）。

STATE_Disp 10 S: 显示 10 秒
   显示心率和呼吸率，然后返回之前的状态。

STATE_MOVEMENT: 运动状态
   显示运动图标，如果运动状态结束，则返回之前的状态。

STATE_Auto_Monitoring: 自动监控状态
   如果检测到在床上，则退出自动唤醒模式，重置为正常模式。如果超过 20 秒没有泵活动，则结束。
循环结束后，跳转到 end 标签，设置 WorkMode 为 0，然后根据 IR 键设置 WorkMode 为 7，然后设置 Auto_Wakeup 为 0，黑暗所有图标，状态设为待机。

##### 接小电源，倒灌电流

##### PCM 使用时间问题
（低电标准从 3.3 V 低电报错改为 3.6 V 报错后的使用影响）
@潘忠群硬件有关 MCU 的电平匹配，以及 IO 的高低电平定义，下午你安排讲解一下。
现有开发的案子要立即进行升级电路并标准化。
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_42.png]]
按照电池用量80%计算可以使用85小时

##### 裸露的 GND❌
##### 马达工作，150mA

##### TM 1640 闪屏问题
TM1640，5 V 供电，2.7V
正常 3.3 V。
电平不匹配

TM 1640 的显示刷新从300多 kHz:900ns→160kHz:2us（NOP 函数加多了一些 nop 指令）
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_43.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_44.png]]
针对低电压屏闪的问题，最先提出预防方法是：进入测量模式后、全显之前先检测一下电压、若低电则退出。

2025 年 11 月 10 日周一：
进入 debug 看了一下是 CheckBatteryCOM1();函数比较器报低电，广哥测了一下发现是泵工作的时候拉低电压造成的。
目前的解决方法是在测量模式下、补气过程中不去检测低电，这样可以正常工作。

##### 串口传输电量数据百分比换算公式
（X-360）X 100/（412-340）
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_45.png]]

### 75/78 语音指令不同
75/78语音 ic使用的指令不同（Soundoff1();SoundOff2();）



电流（300 mA）：
泵开启电流 0.25/0.26->0.4/0.38
待机时 0.03->0.1

### U<sub>n</sub>芯片分类
U 5、U 6--语音 IC
U 7--充电管理 IC
U 4 主控


### 比例阀
直接功能选择选一下就好了，除非本身没写比例阀的驱动程序
「Cherry: 没调过阀」
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_46.png]]
用这个 IDE
一般来说这里直接选就好了（工程：U81RH_BP00C_20250918）
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_47.png]]


### 左右移、取模
1.1 乘法优化：左移位代替乘法；通用公式：value * (2^n) = value << n
1.2 除法优化：右移位代替除法；通用公式：value / (2^n) = value >> n
1.3 取模优化：按位与代替取模；通用公式：value % (2^n) = value & ((1 << n) - 1)
2.1 乘法分解：分解为 2 的幂次方组合
2.2 除法近似：使用移位和调整；

### SDIC 晶华微烧录器
11 月 8 日周六加班
![[../../annex/18.入职第十八周11.9-11.15(单休)_image_48.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_49.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_50.png]]

![[../../annex/18.入职第十八周11.9-11.15(单休)_image_51.jpg]]


























































































































