
这周四晚上，农经理叫老板给我排查思路。

##### 蓝牙 (串口协议)问题排查思路
在 PCM 01 宠物睡眠仪 项目中需要调试蓝牙（串口通信）。该蓝牙只需配置好串口（IO 口输入输出、配置波特率、使能总中断、串口中断，确定好对应的中断服务程序（UART 0/UART 1））

APP->蓝牙->51单片机
现象：接 51 单片机 ->CH 340 USB 转 TTL 串口->PC 电脑端串口调试助手。51 单片机发数据给串口调试助手正常；但是 PC 端通过串口助手发送给 51 单片机，51 单片机无法进入中断服务程序。

① 先接 APP ->蓝牙 ->PC 端（通过 CH 340 、串口调试助手）。查看手机 APP 、蓝牙、PC 端之间是否能够正常的收发数据。查看是否能够正常从手机 APP 下发指令能否在 PC 端接收到；查看是否能够正常从 PC 端发送数据能否在手机 APP 上接收到。（注意波特率要匹配，本次为9600 bps）
②接 51 单片机 ->CH 340 ->PC 端。查看 51 单片机、PC 端之间是否能够正常收发数据。结果发现 51 单片机正常发送给 PC 端；但 PC 端发送给 51 单片机（单片机）却无法接收到。
③检查串口的软件配置是否正常（IO 口 TX 口（P22 引脚）配置输出，RX 口（P23 引脚）配置输入、波特率是否为 9600 bps、串口接收中断是否打开（若不需要发送中断，则不要打开发送中断，即用啥需要啥就打开啥）、总中断、中断使能）。（根据原理图确定蓝牙模块与单片机的连接，看看连接的是串口 0 还是串口 1，要选择正确的串口中断函数）注意中断服务函数是否为 UART 1 的串口中断服务函数，进入串口中断后注意清零 RI 中断接收标志位。注意中断接收缓冲区是否为 S1BUF。
④在硬件配置确定正确的情况下，若 PC 端发送数据给单片机仍无法被接收，则考虑是否硬件出了问题。当时蓝牙接线（VCC、GND、TX、RX 引脚）与 CH 340 共用了 4 根线进行通信。此时，PC 端通过 CH340 发数据给单片机，单片机无法正常接收可能是因为蓝牙模块的内部电路拉高/拉低引脚电平（总之会影响数据通信）。
⑤通过万用表测量 VCC 和 GND 之间的电压，看是否被击穿烧毁了。通过蜂鸣档看看通断情况。正常情况下，配置正确、空闲状态下，GND 和 VCC 之间引脚电平为 3.3 V，而通信引脚与 GND 之间的引脚电平为 2.5 V 左右。


梁浩走了，周六下午突然跟他说转正不合格，还恶心的让人签的“因个人原因离职”的离职申请表。周六晚上 12 点出门去聚最后一顿，方翔云去广州看演唱打顺风车回来已经晚上 12 点多了。一起去吃烧烤、聊聊天，晚上 3 点多回去。
周日晚上 19 点多去帮梁浩搬行李（椅子）到李远端的住宿（他双人房，合租室友还没来）。
















































































































































