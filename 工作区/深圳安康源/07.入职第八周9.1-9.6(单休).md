

Temp=temp%3+1
Temp 在（1~3）循环递增

Temp=(temp-1+3)%3+1
Temp 在（1~3）循环递减，结果始终是一个正整数


C 语言中，if 语句是条件控制结构，而不是循环结构/switch 语句，因此 break 在 if 语句中没有意义且会<font color="#ff0000">报错</font>。
C 语言中，if 语句内部使用 return，程序会立即<font color="#ff0000">退出当前函数</font>并返回到调用该函数的地方。即不仅会中断 if 语句，还会终止整个函数的执行（并且不会继续执行函数中的其他代码）
C 语言中，do-while 循环内部使用 break，程序会立即<font color="#ff0000">退出当前</font><font color="#ff0000">循环</font>并继续执行循环之后的代码。（循环被中断，且循环内部的后续代码不会执行迭代）
C 语言中，do-while 循环内部使用 return，程序会立即<font color="#ff0000">退出当前</font><font color="#ff0000">函数</font>并返回到调用该函数的地方。（循环被中断，且函数内部的后续代码不会执行迭代）

![[../../annex/07.入职第八周9.1-9.6(单休)_image_1.jpg]]


##### 拿到代码发现运行情况有问题，读写不进去
2025 年 9 月 3 日晚上 21 点多才下班。
AXD-804 换英语，拿到储工给的代码程序后发现有问题。设置操作后，EEPROM <font color="#ff0000">读写出现错误</font>。和方翔云发现是写操作出问题（我以为是读出现了问题），最终询问之下发现是<font color="#ff0000">芯片型号对不上</font>。
先通过打断点确定大致的问题所在。先判断是读操作读不出来，还是根本就没有写进去（里面的值没有更改，依旧为 0）
<font color="#ff0000">设置断点缩小基本范围</font>，确定是设置模式设置完后，读出现了问题还是写出现了问题。
确定范围后，再<font color="#ff0000">单步调试</font>，进入写操作的函数，逐步查看和分析代码的运行、变量的变化。
一方面，需要分析读写操作是否为同一片存储空间区域（起始地址、偏移量、偏移地址、读取地址对应的内容）
一方面，需要分析读写操作时，每一步的运行情况，查看值的具体变化，有没有真正写进去。
最终发现是芯片型号对不上，导致的读写操作失败。
断点调试过程中，一方面，可以通告 watch 查看变量的变化；一方面，可以通告 memory ，搜索具体的地址（如查看 EEPROM 写操作存储区对应的地址 0xFC，在 Memory 中查看 0 xFC 的值，查看二进制 0、1 的具体数值）
根本原因是：芯片 IC 和代码程序不一致。（芯片 IC 是 BP004 型号，代码及要求是 BP 004C 型号）
在项目代码拿到手的第一时间，如果发现代码基本运行出现问题（非需要修改的代码内容、且是代码的基础功能，如 EEPROM 读写操作有问题），可以先通过 keil 的 debug 中查看识别到的芯片型号，与项目代码、修改需求是否对应一致。若不一致，则需要跟组长/负责人对接确定。


#### 代码运行显示不对
AXD-846 E。拿到样机后发现显示有问题，在仿真后发现依旧是乱码：
1、明明写的是收缩压个位输出字符“8”，但显示的不是字符“8”，是乱码，且在舒张压个位也同步显示相同乱码。
2、LCD 显示不清晰，调试后发现不是电压问题（有一定影响，电压过低供电不足，会导致直接几乎不显示）
3、首先排除是芯片型号不对的问题，其次排除 Keil 版本问题
4、debug 仿真单步断点发现，代码运行异常，会乱走到其他代码位置。在显示函数 DisplayHalfByte (data,position)中，发现函数内部 switch 中，部分代码打不了断点。经过分析和查询，发现是 Keil C51 的优化等级太高（设为了 8 级），导致可执行代码无法打断点，修改为默认的优化等级即可。
5、拆掉样机，查看 LCD 连接，发现导电条是海绵条一样，而不是斑马纸连接。在重新加固（拧紧螺丝）后，发现显示正常了。样机（也能识别到芯片了）进入 debug 仿真（之前经常识别不到芯片，需要多次反复开闭仿真器直到之别到芯片）
6、芯片识别不到，不知道是什么原因，一开始怀疑是仿真器的接线不良，重新焊接 2 次后排除这个可能性。虽然不知道根本原因是什么，但是在电路板加固螺丝，LCD 显示正常后，识别芯片的概率有所提升。
7、LCD 驱动电压（该 LCD 可通过 LCDM2 寄存器，赋值 0x0n 设置供电在2.5 V~4.5 V 范围）设置过高会导致低影重，LCD 电压设置过低会导致显示不清晰（需要侧着、斜着看才能看清，正面看不清）



#### 充气关机时间哪里调
测量模式，开始打气到报错关机的时间在打气时间检测函数中（checkpumptime）进行修改。
臂带松紧检测通过 2 个条件判断：
①打气时间在 10 秒内
②打气压力＞30 mmHg

报错 E-3 还有一种是：充气过慢，打气到 160 mmHg 的总打气时间>30s-37s 左右的范围

旧代码从打气到报错的时间通常有以下几个数值：8s、12s、15s，现版本为 16 秒后报错
![[../../annex/07.入职第八周9.1-9.6(单休)_image_2.png]]
AutoOffTimew 在定时器中递增，每 18.75 ms 加 1。为计算自动关机时间
通常在无操作后（包括报错完毕，若有语音通常在语音播报前几 ms 开始计时，即在语音播报时已经开始计算自动关机时间；按键按下跳转到相应界面后开始计时；写记忆等工程模式运行完毕后）清零开始计时
![[../../annex/07.入职第八周9.1-9.6(单休)_image_3.png]]


远古 bug：写记忆会改变样机时间，这通常是以前的代码直接操作系统的时间 year.b 等。正确的方式应该是通过中间变量=year.b 等, 再用中间变量进行分配写记忆中各记忆组的时间。另外对应的，写记忆时时间显示函数也需要进行区分，可以通告 showmemorytime、showmemorydate 函数进行显示，因为这 2 个函数可以传参显示；而 showdata、showtime、showhour、showmin 等函数则无参，不方便使用和显示临时变量时间。

AutotestFlag--EMC 模式的标志位（EMC 模式即在 main 函数中的 STARTTEST 标签中反复执行充气打气，但无特殊的显示，如万次寿命会有 5 个 0 以代表万次寿命次数 ）

优瑞恩的样机通常没有自动工装函数（无自动工装校准功能）；工程模式退出后会全显图标→清屏→显示记忆图标和组数→熄屏关机；优瑞恩和爱芯达的工程模式-万次寿命有一家可以通过设置键打断打气、启停气泵，而另一家不能。













































































































































































